{% extends "base.html" %}
{% load static %}

{% block title %}Cart{% endblock %}

{% block content %}
<div class="container" style="max-width: 700px; margin: 40px auto;">
    <h2 style="font-weight: bold; color: #f76d37; margin-bottom: 30px;">Your Cart</h2>
    <div id="cart-page-items"></div>
    <div id="cart-page-total-section" style="margin-top: 20px; display: none;">
        <hr />
        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2em;">
            <span>Total:</span>
            <span id="cart-page-total">Rs 0</span>
        </div>
        <button id="cart-page-checkout-btn" style="margin-top: 18px; width: 100%; background: #f76d37; color: #fff; border: none; border-radius: 5px; padding: 12px 0; font-weight: bold; font-size: 1.1em;">Proceed to Checkout</button>
    </div>
    <div id="cart-page-empty" style="color: #888; font-size: 1.1em;">Your cart is empty.</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Cart page logic (syncs with localStorage)
function renderCartPage() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const itemsDiv = document.getElementById('cart-page-items');
    const totalSection = document.getElementById('cart-page-total-section');
    const totalSpan = document.getElementById('cart-page-total');
    const emptyDiv = document.getElementById('cart-page-empty');
    if (!cart.length) {
        itemsDiv.innerHTML = '';
        totalSection.style.display = 'none';
        emptyDiv.style.display = 'block';
        return;
    }
    let html = '';
    let total = 0;
    cart.forEach((item, idx) => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        html += `
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <div style="flex: 1;">
                    <div style="font-weight: bold; color: #222; font-size: 1.1em;">${item.name}</div>
                    <div style="font-size: 1em; color: #888;">Rs ${item.price} x 
                        <button class="cart-qty-btn" data-idx="${idx}" data-action="minus" style="border:none;background:none;font-weight:bold;color:#f76d37;">-</button>
                        <span style="margin:0 6px;">${item.quantity}</span>
                        <button class="cart-qty-btn" data-idx="${idx}" data-action="plus" style="border:none;background:none;font-weight:bold;color:#f76d37;">+</button>
                    </div>
                </div>
                <div style="margin-left: 10px; font-weight: bold; color: #f76d37;">Rs ${itemTotal}</div>
                <button class="cart-remove-btn" data-idx="${idx}" style="margin-left: 10px; background: none; border: none; color: #d32f2f; font-size: 1.5em;">&times;</button>
            </div>
        `;
    });
    itemsDiv.innerHTML = html;
    totalSpan.textContent = `Rs ${total}`;
    totalSection.style.display = 'block';
    emptyDiv.style.display = 'none';
    // Remove item
    itemsDiv.querySelectorAll('.cart-remove-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const idx = parseInt(this.dataset.idx);
            removeFromCart(idx);
            renderCartPage();
            updateCartBadge();
        });
    });
    // Quantity change
    itemsDiv.querySelectorAll('.cart-qty-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const idx = parseInt(this.dataset.idx);
            const action = this.dataset.action;
            updateCartQuantity(idx, action);
            renderCartPage();
            updateCartBadge();
        });
    });
}
function removeFromCart(idx) {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    cart.splice(idx, 1);
    localStorage.setItem('cart', JSON.stringify(cart));
}
function updateCartQuantity(idx, action) {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    if (action === 'plus') {
        cart[idx].quantity += 1;
    } else if (action === 'minus' && cart[idx].quantity > 1) {
        cart[idx].quantity -= 1;
    }
    localStorage.setItem('cart', JSON.stringify(cart));
}
function updateCartBadge() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const cartCount = document.getElementById('cart-count');
    if (cartCount) {
        cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
    }
}
document.addEventListener('DOMContentLoaded', renderCartPage);
</script>
{% endblock %} 